<form id="form">
  <div class="field">
    <label for="name">Name</label>
    <input type="text" name="name" id="name" required minlength="3">
    <span id="name-warning" class="error-message">Name must be at least 3 characters long.</span>
  </div>

  <div class="field">
    <label for="email">Email</label>
    <input type="email" name="email" id="email" required>
    <span id="email-warning" class="error-message">Please enter a valid email address.</span>
  </div>

  <div class="field">
    <label for="phone">Phone Number (optional)</label>
    <input type="tel" name="phone" id="phone">
  </div>

  <div class="field">
    <label for="subject">Subject</label>
    <input type="text" name="subject" id="subject" required>
  </div>

  <div class="field">
    <label for="message">Tell Us More About Your Project</label>
    <textarea name="message" id="message" rows="4" minlength="30" required></textarea>
    <span id="message-warning" class="error-message">Please enter at least 30 characters.</span>
  </div>

  <input type="submit" id="button" value="Submit">
  <p id="thank-you-message" style="display: none;">Thank you for reaching out. We will get back to you as soon as we have finished processing your request.</p>
  <a id="new-response-link" href="#" style="display: none;">Submit another response</a>
</form>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<script type="text/javascript">
  emailjs.init('PLIWfEgLqX3-a6V-O'); // Replace with your EmailJS User ID

  const form = document.getElementById('form');
  const button = document.getElementById('button');
  const thankYouMessage = document.getElementById('thank-you-message');
  const newResponseLink = document.getElementById('new-response-link');

  // Error elements
  const emailWarning = document.getElementById('email-warning');
  const nameWarning = document.getElementById('name-warning');
  const messageWarning = document.getElementById('message-warning');

  form.addEventListener('submit', function(event) {
    event.preventDefault();
    
    // Hide warnings initially
    emailWarning.style.display = 'none';
    nameWarning.style.display = 'none';
    messageWarning.style.display = 'none';
    
    let valid = true;

    // Name validation (min 3 characters)
    const nameInput = document.getElementById('name');
    if (nameInput.value.length < 3) {
      nameWarning.style.display = 'block';
      valid = false;
    }

    // Email validation
    const emailInput = document.getElementById('email');
    const emailRegex = /^.+@(gmail\.com|yahoo\.com|outlook\.com|hotmail\.com|icloud\.com|aol\.com|protonmail\.com|zoho\.com|mail\.com|gmx\.com|qq\.com|126\.com|163\.com)$/;
    if (!emailRegex.test(emailInput.value)) {
      emailWarning.style.display = 'block';
      valid = false;
    }

    // Message validation (min 30 characters)
    const messageInput = document.getElementById('message');
    if (messageInput.value.length < 30) {
      messageWarning.style.display = 'block';
      valid = false;
    }

    if (!valid) return; // Stop submission if not valid

    // Show "Sending" status
    button.value = 'Sending...';

    const serviceID = 'default_service';
    const templateID = 'template_1bvknlu';

    emailjs.sendForm(serviceID, templateID, this)
      .then(() => {
        button.value = 'Submit';
        
        // Show thank you message, hide form fields
        thankYouMessage.style.display = 'block';
        form.style.display = 'none'; // Hide form after successful submission
        newResponseLink.style.display = 'block';
        form.reset(); // Clear form fields
      }, (err) => {
        button.value = 'Submit';
        alert('Failed to send message. Please try again.');
      });
  });

  // New response link resets the form
  newResponseLink.addEventListener('click', function(event) {
    event.preventDefault();
    thankYouMessage.style.display = 'none';
    newResponseLink.style.display = 'none';
    form.style.display = 'flex'; // Reset form display to flex to prevent shifting
  });
</script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@300&display=swap');

  body {
    font-family: 'DM Sans', sans-serif;
    color: black;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    text-align: center;
  }

  #form {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    max-width: 100%;
    margin: 0 auto;
    padding: 20px;
    width: 100%;
    box-sizing: border-box;
  }

  .field {
    margin-bottom: 5px;
    width: 100%;
    max-width: 400px;
    text-align: center;
  }

  .field label {
    display: block;
    font-size: 16px;
    color: black;
    margin-bottom: 5px;
    text-align: center;
  }

  .field input, .field textarea {
    width: 100%;
    padding: 8px;
    font-size: 15px;
    border: 1px solid #ccc;
    border-radius: 4px;
    resize: none;
  }

  input[type="submit"] {
    padding: 10px;
    font-size: 16px;
    background-color: #3c78d8;
    font-family: 'DM Sans', sans-serif;
    font-weight: 300;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    width: 100%;
    max-width: 400px;
    margin-top: 10px;
  }

  input[type="submit"]:hover {
    background-color: #5a79d6;
  }

  .error-message {
    font-size: 14px;
    color: red;
    display: none;
  }

  #thank-you-message {
    font-size: 16px;
    margin-top: 10px;
    color: green;
  }

  @media (max-width: 768px) {
    #form {
      padding: 10px;
    }
  }

  @media (max-width: 576px) {
    #form {
      padding: 5px;
    }
  }
</style>
